{% extends "base.html" %}

{% block content %}
<div class="auth-container">
  <h2>Register</h2>

  <!-- Added field-level error placeholders -->
  <form id="registerForm" method="post" action="/register">
    <div class="form-field">
      <input type="text" id="username" name="username" placeholder="Choose a username" required>
      <!-- 游릭 [1] Username-specific error placeholder -->
      {% if username_error %}
        <p class="error">{{ username_error }}</p>
      {% endif %}
    </div>

    <div class="form-field">
      <input type="password" id="password" name="password" placeholder="Choose a password" required>
      <!-- 游릭 [2] Password-specific error placeholder -->
      {% if password_error %}
        <p class="error">{{ password_error }}</p>
      {% endif %}
    </div>

    <button type="submit">Register</button>
  </form>

  <!-- 游릭 [3] General message (for success or non-field-specific errors) -->
  {% if error %}
    <p class="error">{{ error }}</p>
  {% endif %}
  {% if message %}
    <p class="message">{{ message }}</p>
  {% endif %}

  <p class="switch-link">Already have an account? <a href="/">Login here</a></p>
</div>

<!-- 游릭 [4] Client-side validation (instant feedback) -->
<script>
document.getElementById('registerForm').addEventListener('submit', function (e) {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;

  // Remove previous JS-generated errors if any
  document.querySelectorAll(".js-error").forEach(el => el.remove());

  let hasError = false;

  if (username.length < 3) {
    const el = document.createElement("p");
    el.className = "error js-error";
    el.textContent = "Username must be at least 3 characters long.";
    document.getElementById('username').insertAdjacentElement("afterend", el);
    hasError = true;
  }

  const strongPass = /^(?=.*[A-Za-z])(?=.*\d).{6,}$/;
  if (!strongPass.test(password)) {
    const el = document.createElement("p");
    el.className = "error js-error";
    el.textContent = "Password must be at least 6 characters long and include both letters and numbers.";
    document.getElementById('password').insertAdjacentElement("afterend", el);
    hasError = true;
  }

  if (hasError) {
    e.preventDefault(); // stop form submission
  }
});
</script>

<style>
/* Optional: make field-level errors smaller and red */
.form-field .error {
  color: #d33;
  font-size: 0.85em;
  margin-top: 4px;
}
</style>
{% endblock %}
